apiVersion: of-catalog/v1alpha1
kind: Component
metadata:
    name: simple-service
    componentType: service
spec:
    id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:component/4d010f50-96c4-48c0-bab5-a3dd5112b464/5d104332-6726-418a-873a-8d6cafa0b858
    name: simple-service
    slug: svc-simple-service
    description: Simple-service is a no-nonsense, do-what-it-needs-to-do kind of service. It reads a lot, writes a little, and somehow still manages to act important. If databases had best friends, Simple RDS would be its ride-or-die.
    configVersion: 0
    typeId: SERVICE
    ownerId: ari:cloud:identity::team/5a8eb464-b74d-46b1-b7b2-0b17efc117b6
    dependsOn:
        - kubernetes
    fields:
        lifecycle: Active
        tier: 3
    links:
        - id: d4712302-1e32-47c2-a00f-b3e5b6ffe841
          name: Emissary Metrics
          type: DASHBOARD
          url: https://grafana.mgm.onefootball.com/d/z387xeWVk/ambassador-emissary-ingress?var-window=1m&orgId=1&from=now-30m&to=now&timezone=browser&var-DS_PROMETHEUS=P0F161AC36DE6FE17&var-SERVICE=simple_service_simple_service_svc_cluster_local_&refresh=5s
        - id: feb0c67a-341b-4163-bb30-bacaf4cc46a4
          name: Cloud Runtime
          type: PROJECT
          url: https://onefootball.atlassian.net/jira/software/projects/CORE/boards/185
        - id: 30bd29ca-29e0-405d-9fc6-30bda819e979
          name: Honeycomb
          type: DASHBOARD
          url: https://ui.eu1.honeycomb.io/onefootball/environments/production/datasets/simple-service/home?tab=traces
        - id: 80a2f74a-1e08-4fec-8e08-6ddc5b500054
          name: Security Vulnerability Report
          type: DASHBOARD
          url: https://grafana.mgm.onefootball.com/d/ycwPj724k/trivy-operator-dashboard?orgId=1&from=now-24h&to=now&timezone=browser&var-DS_PROMETHEUS=P0F161AC36DE6FE17&var-namespace=simple-service
        - id: d9476632-b70e-4cdd-b540-bf89b42d2f05
          name: p-cloud-runtime
          type: CHAT_CHANNEL
          url: https://onefootball.slack.com/archives/CFUCQUA04
        - id: 5a139bc2-1f5f-4ce7-b3b4-6a4c5350ba1c
          name: Prometheus Resource Metrics
          type: DASHBOARD
          url: https://grafana.mgm.onefootball.com/d/pthfJGV4z/kubernetes-app-metrics?orgId=1&refresh=30s&var-DS_PROMETHEUS=P0F161AC36DE6FE17&var-namespace=simple-service&var-container=simple-service&from=now-1h&to=now
        - id: 8dbd554f-fe8b-455f-b62c-71c85ac1a860
          name: Repository
          type: REPOSITORY
          url: https://github.com/motain/simple-service
        - id: 43856881-a223-492f-a9c8-ca5b456727e3
          name: OnCall
          type: ON_CALL
          url: https://onefootball.app.opsgenie.com/settings/schedule/detail/191b6b6d-f7eb-4a88-977e-bcc12f38b1b9
    documents:
        - id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:document/4d010f50-96c4-48c0-bab5-a3dd5112b464/8a733616-84d0-4938-9332-e79d0e4d692e
          title: README
          type: Other
          documentationCategoryId: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:documentation-category/4d010f50-96c4-48c0-bab5-a3dd5112b464/154bf547-86c3-4d30-a74e-e73569ae37f8
          url: https://github.com/motain/simple-service/blob/master/docs/README.md
    labels:
        - cloud-runtime
        - platform
    metricSources:
        adaptive-systems:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/e192b704-e1e3-484c-b1dc-4b7c417437b3
            name: adaptive-systems-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/d6af0782-90a4-44e6-a9e9-4535573bd716
            facts:
                - id: app-toml-replicas-min
                  type: extract
                  source: github
                  jsonPath: .service.replicas_min // .service.production.replicas_min | . >= 3
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: app-toml-replicas-max-gt-replicas-min
                  type: extract
                  source: github
                  jsonPath: (.service.replicas_min // .service.production.replicas_min) < (.service.replicas_max // .service.production.replicas_max)
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: cpu-and-memory-hpa-are-set
                  name: Validate that CPU and Memory Horizontal Pod Autoscalers are set
                  type: aggregate
                  dependsOn:
                    - app-toml-replicas-min
                    - app-toml-replicas-max-gt-replicas-min
                  method: and
        alert-routing-and-notifications:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/b98a1158-290a-4a3f-b595-83f5d0cac818
            name: alert-routing-and-notifications-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/a475e853-8c43-47af-8b94-99240e853480
            facts:
                - id: fetch-slos
                  name: Fetch SLOs
                  type: extract
                  source: jsonapi
                  uri: https://api.eu1.honeycomb.io/1/slos/simple-service
                  jsonPath: .[].id
                  auth:
                    header: X-Honeycomb-Team
                    tokenVar: HONEYCOMB_API_KEY
                  rule: jsonpath
                - id: fetch-alerts-for-slos
                  name: Fetch alerts for SLOs
                  type: extract
                  dependsOn:
                    - fetch-slos
                  source: jsonapi
                  uri: https://api.eu1.honeycomb.io/1/burn_alerts/simple-service?slo_id=:slo_id
                  jsonPath: .[].id
                  auth:
                    header: X-Honeycomb-Team
                    tokenVar: HONEYCOMB_API_KEY
                  rule: jsonpath
                - id: fetch-recipients-for-alerts
                  name: Fetch recipients for Alerts
                  type: extract
                  dependsOn:
                    - fetch-alerts-for-slos
                  source: jsonapi
                  uri: https://api.eu1.honeycomb.io/1/burn_alerts/simple-service/:alert_id
                  jsonPath: .recipients[].target
                  auth:
                    header: X-Honeycomb-Team
                    tokenVar: HONEYCOMB_API_KEY
                  rule: jsonpath
                - id: validate-each-target-is-not-empty-string
                  name: Validate that each target is not an empty string
                  type: validate
                  dependsOn:
                    - fetch-recipients-for-alerts
                  rule: regex_match
                  pattern: ^\S.*$
                - id: validate-all-targets-are-not-empty-strings
                  name: Validate that all targets are not empty strings
                  type: aggregate
                  dependsOn:
                    - validate-each-target-is-not-empty-string
                  method: and
        allocation-efficiency:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/9ae2bd0e-cbee-4241-9410-d8cf01d7517c
            name: allocation-efficiency-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/0280d248-c53a-4dcf-a5a4-945cdd931406
            facts:
                - id: check-app-toml-resource-request
                  name: Check if CPU requests and memory requests are defined in app.toml under [service] or [service.production]
                  type: extract
                  source: github
                  jsonPath: (.service.cpu_requests // .service.production.cpu_requests | . != null) and (.service.memory_requests // .service.production.memory_requests | . != null)
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: check-app-toml-cpu-limits
                  name: Check if CPU limits are not defined in app.toml under [service] or [service.production]
                  type: extract
                  source: github
                  jsonPath: .service.cpu_limits // .service.production.cpu_limits | not
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: check-app-toml-memory-limits
                  name: Check if  memory limits are defined in app.toml under [service] or [service.production]
                  type: extract
                  source: github
                  jsonPath: .service.memory_limits // .service.production.memory_limits | . != null
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: aggregate-resource-requests
                  name: check resource requests and limits
                  type: aggregate
                  dependsOn:
                    - check-app-toml-resource-request
                    - check-app-toml-cpu-limits
                    - check-app-toml-memory-limits
                  method: and
        critical-alerts-slo-check:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/97dce8d4-f796-4e7c-b66d-dfed59539e27
            name: critical-alerts-slo-check-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/80249b35-572f-41be-9f7d-78d7ca793029
            facts:
                - id: fetch-slos
                  name: Fetch SLOs
                  type: extract
                  source: jsonapi
                  uri: https://api.eu1.honeycomb.io/1/slos/simple-service
                  jsonPath: .[].id
                  auth:
                    header: X-Honeycomb-Team
                    tokenVar: HONEYCOMB_API_KEY
                  rule: jsonpath
                - id: fetch-alerts-for-slos
                  name: Fetch alerts for SLOs
                  type: extract
                  dependsOn:
                    - fetch-slos
                  source: jsonapi
                  uri: https://api.eu1.honeycomb.io/1/burn_alerts/simple-service?slo_id=:slo_id
                  jsonPath: .[].id
                  auth:
                    header: X-Honeycomb-Team
                    tokenVar: HONEYCOMB_API_KEY
                  rule: jsonpath
                - id: count-slos
                  name: Count SLOs
                  type: aggregate
                  dependsOn:
                    - fetch-slos
                  method: count
                - id: count-alerts-for-slos
                  name: Count Alerts
                  type: aggregate
                  dependsOn:
                    - fetch-alerts-for-slos
                  method: count
                - id: validate-alerts-for-slos
                  name: Validate that counts match
                  type: validate
                  dependsOn:
                    - count-slos
                    - count-alerts-for-slos
                  rule: deps_match
        deployment-readiness:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/acf88108-e2ff-40ff-af41-4aca0c937ab1
            name: deployment-readiness-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/e9c34910-156e-4669-b283-3d3bb08c58ac
            facts:
                - id: deployment-readiness-replicas-service-production
                  name: Check deployment readiness where min != Max, Min >= 3 and Max > 3
                  type: extract
                  source: github
                  jsonPath: (.service.production.replicas_min != .service.production.replicas_max) and (.service.production.replicas_min >= 3) and (.service.production.replicas_max > 3)
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: deployment-readiness-replicas-service
                  name: Check deployment readiness where min != Max, Min >= 3 and Max > 3
                  type: extract
                  source: github
                  jsonPath: (.service.replicas_min != .service.replicas_max) and (.service.replicas_min >= 3) and (.service.replicas_max > 3)
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: aggregate-replicas
                  name: Check deployment readiness where min != Max, Min >= 3 and Max > 3
                  type: aggregate
                  dependsOn:
                    - deployment-readiness-replicas-service-production
                    - deployment-readiness-replicas-service
                  method: or
        high-availability:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/18c2cebd-bfb0-4fd7-8a34-a767ba94599b
            name: high-availability-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/43e2c6ef-1a41-4fd6-b0e9-d7d7545681fd
            facts:
                - id: app-toml-hpa-target-cpu
                  type: extract
                  source: github
                  jsonPath: .service.target_cpu_utilization_percentage // .service.production.target_cpu_utilization_percentage | . >= 20
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: app-toml-hpa-target-memory
                  type: extract
                  source: github
                  jsonPath: .service.target_memory_utilization_percentage // .service.production.target_memory_utilization_percentage | . >= 20
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: cpu-and-memory-hpa-are-set
                  name: Validate that CPU and Memory Horizontal Pod Autoscalers are set
                  type: aggregate
                  dependsOn:
                    - app-toml-hpa-target-cpu
                    - app-toml-hpa-target-memory
                  method: or
        instrumentation-check:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/1cf8d5e5-c90d-4127-af6b-1eef5024dcad
            name: instrumentation-check-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/be5dd5aa-9468-4dd1-8e7a-580b9da4e5c6
            facts:
                - id: read-otel-service-name-from-apptoml
                  name: Read OTEL_SERVICE_NAME from app.toml
                  type: extract
                  source: github
                  jsonPath: .envs.OTEL_SERVICE_NAME // .envs.production.OTEL_SERVICE_NAME // .service.production.envs.OTEL_SERVICE_NAME // .service.envs.OTEL_SERVICE_NAME
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: validate-otel-service-name-matches-component-name
                  name: validate OTEL_SERVICE_NAME matches component name
                  type: validate
                  dependsOn:
                    - read-otel-service-name-from-apptoml
                  rule: regex_match
                  pattern: ^simple-service.*$
                - id: read-otel-resource-attributes-from-apptoml
                  name: Read OTEL_RESOURCE_ATTRIBUTES from app.toml
                  type: extract
                  source: github
                  jsonPath: .envs.OTEL_RESOURCE_ATTRIBUTES // .envs.production.OTEL_RESOURCE_ATTRIBUTES // .service.production.envs.OTEL_RESOURCE_ATTRIBUTES
                  repo: simple-service
                  filePath: app.toml
                  rule: jsonpath
                - id: validate-otel-resource-attributes-sample-rate
                  name: validate OTEL_RESOURCE_ATTRIBUTES defines sample rate
                  type: validate
                  dependsOn:
                    - read-otel-resource-attributes-from-apptoml
                  rule: regex_match
                  pattern: of\.sample_rate=\d+.*
                - id: validate-otel-resource-attributes-one-sample-rate
                  name: validate OTEL_RESOURCE_ATTRIBUTES defines one sample rate
                  type: validate
                  dependsOn:
                    - read-otel-resource-attributes-from-apptoml
                  rule: regex_match
                  pattern: of\.error_sample_rate=\d+.*
                - id: either-sample-rate-or-error-sample-rate
                  name: Validate that OTEL_RESOURCE_ATTRIBUTES contains either of.sample_rate or of.error_sample_rate
                  type: aggregate
                  dependsOn:
                    - validate-otel-resource-attributes-sample-rate
                    - validate-otel-resource-attributes-error-sample-rate
                  method: or
                - id: either-sample-rate-or-error-sample-rate
                  name: Validate that both OTEL_SERVICE_NAME and OTEL_RESOURCE_ATTRIBUTES are set up correctly
                  type: aggregate
                  dependsOn:
                    - validate-otel-service-name-matches-component-name
                    - validate-otel-resource-attributes-one-sample-rate
                  method: and
        observability-documentation:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/38d9992b-a362-4c5f-982a-4af0ef86f743
            name: observability-documentation-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/f133b6d9-595f-4862-a10d-cb356968e2bc
            facts:
                - id: extract-observability-md
                  name: Extract observability.md
                  type: extract
                  source: github
                  repo: simple-service
                  filePath: docs/observability.md
                  rule: notempty
        organizational-standards:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/2f11aca3-d148-4909-8f7b-0e5ea87c52bf
            name: organizational-standards-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/557a1209-6a66-4eda-8051-9634991b75f2
            facts:
                - id: readme-file
                  name: Check if the README.md file exists
                  type: extract
                  source: github
                  repo: simple-service
                  filePath: README.md
                  rule: notempty
                - id: docs-readme-file
                  name: Check if the docs/README.md file exists
                  type: extract
                  source: github
                  repo: simple-service
                  filePath: docs/README.md
                  rule: notempty
                - id: docs-index-file
                  name: Check if the docs/index.md file exists
                  type: extract
                  source: github
                  repo: simple-service
                  filePath: docs/index.md
                  rule: notempty
                - id: paas-onboarded
                  name: Check if the service is using PaaS
                  type: extract
                  source: github
                  repo: simple-service
                  searchString: motain/onefootball-actions/paas-deploy@master
                  rule: search
                - id: aggregate-readme-exists
                  name: Check if repo has documentation
                  type: aggregate
                  dependsOn:
                    - docs-index-file
                    - docs-readme-file
                    - readme-file
                  method: or
                - id: aggregate
                  name: Check if repo follows organizational standards
                  type: aggregate
                  dependsOn:
                    - aggregate-readme-exists
                    - paas-onboarded
                  method: and
        security-as-pipeline:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/d079c312-6c63-4de8-bfa0-6625a3f6af4d
            name: security-as-pipeline-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/f16a5dad-816a-48db-9e96-6d1250e63659
            facts:
                - id: trivy-exists-in-ci
                  name: Check if Trivy is used in CI/CD pipeline
                  type: extract
                  source: github
                  repo: simple-service
                  searchString: motain/onefootball-actions/security
                  rule: search
        vulnerability-management:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/de3873ba-2e22-4e3c-a8b9-8443bb776c96
            name: vulnerability-management-svc-simple-service
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/6390dfc8-c94e-492a-8741-3fcbfa2fbddb
            facts:
                - id: service-vulnerabilities-prometheus
                  name: Get summary of vulnerabilities for services from Prometheus reports
                  type: extract
                  source: prometheus
                  prometheusQuery: sum(trivy_image_vulnerabilities{namespace="simple-service", severity="Critical" })
    tribe: platform
    squad: cloud-runtime
