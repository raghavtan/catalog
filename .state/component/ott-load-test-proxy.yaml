apiVersion: of-catalog/v1alpha1
kind: Component
metadata:
    name: ott-load-test-proxy
    componentType: service
spec:
    id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:component/4d010f50-96c4-48c0-bab5-a3dd5112b464/3c18f352-d4ce-4803-b460-1cca7e3dbe84
    name: ott-load-test-proxy
    slug: svc-ott-load-test-proxy
    description: Component ott-load-test-proxy
    configVersion: 0
    typeId: SERVICE
    ownerId: ari:cloud:identity::team/a1604116-f750-4bb3-a850-800958ce934a
    dependsOn:
        - kubernetes
    fields:
        lifecycle: Active
        tier: 3
    links:
        - id: 24eee7fe-e5ba-43ad-8c09-ee1970586736
          name: Repository
          type: REPOSITORY
          url: https://github.com/motain/ott-load-test-proxy
        - id: fa9a5f96-4172-4552-99fa-f6ceaa66b489
          name: Prometheus Resource Metrics
          type: DASHBOARD
          url: https://grafana.mgm.onefootball.com/d/pthfJGV4z/kubernetes-app-metrics?orgId=1&refresh=30s&var-DS_PROMETHEUS=P0F161AC36DE6FE17&var-namespace=ott-load-test-proxy&var-container=ott-load-test-proxy&from=now-1h&to=now
        - id: ba48b29b-f1d8-4bc7-8605-2ca8b25062d5
          name: Emissary Metrics
          type: DASHBOARD
          url: https://grafana.mgm.onefootball.com/d/z387xeWVk/ambassador-emissary-ingress?var-window=1m&orgId=1&from=now-30m&to=now&timezone=browser&var-DS_PROMETHEUS=P0F161AC36DE6FE17&var-SERVICE=ott_load_test_proxy_ott_load_test_proxy_svc_cluster_local_&refresh=5s
        - id: d29fb9ad-70ab-4064-b7a1-648a8a017a4b
          name: e-livevideo
          type: CHAT_CHANNEL
          url: https://onefootball.slack.com/archives/C053ATVH3N2
        - id: 53c81366-5bd4-4655-b84f-f6532cac25ea
          name: OnCall
          type: ON_CALL
          url: https://onefootball.app.opsgenie.com/settings/schedule/detail/191b6b6d-f7eb-4a88-977e-bcc12f38b1b9
        - id: 5be3552d-6f97-4893-b9c6-24ee0a9d3de4
          name: Honeycomb
          type: DASHBOARD
          url: https://ui.eu1.honeycomb.io/onefootball/environments/production/datasets/ott-load-test-proxy/home?tab=traces
        - id: a7e0d2cc-89f1-4fed-8dc5-6610c94f71b2
          name: Security Vulnerability Report
          type: DASHBOARD
          url: https://grafana.mgm.onefootball.com/d/ycwPj724k/trivy-operator-dashboard?orgId=1&from=now-24h&to=now&timezone=browser&var-DS_PROMETHEUS=P0F161AC36DE6FE17&var-namespace=ott-load-test-proxy
        - id: f4eed135-4605-4911-890a-edd135957c3f
          name: Live Video
          type: PROJECT
          url: https://onefootball.atlassian.net/jira/software/projects/LIVEVIDEO/boards/300
    documents:
        - id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:document/4d010f50-96c4-48c0-bab5-a3dd5112b464/7ed5b597-98d6-49e5-b17d-67194b9c85fd
          title: README
          type: Other
          documentationCategoryId: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:documentation-category/4d010f50-96c4-48c0-bab5-a3dd5112b464/154bf547-86c3-4d30-a74e-e73569ae37f8
          url: https://github.com/motain/ott-load-test-proxy/blob/main/docs/index.md
        - id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:document/4d010f50-96c4-48c0-bab5-a3dd5112b464/e2e81d82-4062-466f-a2e6-deec1cbb8bc6
          title: Readme
          type: Other
          documentationCategoryId: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:documentation-category/4d010f50-96c4-48c0-bab5-a3dd5112b464/154bf547-86c3-4d30-a74e-e73569ae37f8
          url: https://github.com/motain/ott-load-test-proxy/blob/main/docs/index.md
    labels:
        - live-video
        - ott
    metricSources:
        adaptive-systems:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/328c187d-d55a-4030-897f-739ea766ef40
            name: adaptive-systems-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/d6c1a5ed-b0ce-4fed-b020-0a445cc8e6b2
            facts:
                - id: app-toml-replicas-min
                  type: extract
                  source: github
                  jsonPath: .service.replicas_min // .service.production.replicas_min | . >= 3
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: app-toml-replicas-max-gt-replicas-min
                  type: extract
                  source: github
                  jsonPath: (.service.replicas_min // .service.production.replicas_min) < (.service.replicas_max // .service.production.replicas_max)
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: cpu-and-memory-hpa-are-set
                  name: Validate that CPU and Memory Horizontal Pod Autoscalers are set
                  type: aggregate
                  dependsOn:
                    - app-toml-replicas-min
                    - app-toml-replicas-max-gt-replicas-min
                  method: and
        alert-routing-and-notifications:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/1be5e6e3-562f-4959-9dde-63b6cdc12688
            name: alert-routing-and-notifications-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/1f42301f-6118-4aef-8a45-80d5b63a0d93
            facts:
                - id: fetch-slos
                  name: Fetch SLOs
                  type: extract
                  source: jsonapi
                  uri: https://api.eu1.honeycomb.io/1/slos/ott-load-test-proxy
                  jsonPath: .[].id
                  auth:
                    header: X-Honeycomb-Team
                    tokenVar: HONEYCOMB_API_KEY
                  rule: jsonpath
                - id: fetch-alerts-for-slos
                  name: Fetch alerts for SLOs
                  type: extract
                  dependsOn:
                    - fetch-slos
                  source: jsonapi
                  uri: https://api.eu1.honeycomb.io/1/burn_alerts/ott-load-test-proxy?slo_id=:slo_id
                  jsonPath: .[].id
                  auth:
                    header: X-Honeycomb-Team
                    tokenVar: HONEYCOMB_API_KEY
                  rule: jsonpath
                - id: fetch-recipients-for-alerts
                  name: Fetch recipients for Alerts
                  type: extract
                  dependsOn:
                    - fetch-alerts-for-slos
                  source: jsonapi
                  uri: https://api.eu1.honeycomb.io/1/burn_alerts/ott-load-test-proxy/:alert_id
                  jsonPath: .recipients[].target
                  auth:
                    header: X-Honeycomb-Team
                    tokenVar: HONEYCOMB_API_KEY
                  rule: jsonpath
                - id: validate-each-target-is-not-empty-string
                  name: Validate that each target is not an empty string
                  type: validate
                  dependsOn:
                    - fetch-recipients-for-alerts
                  rule: regex_match
                  pattern: ^\S.*$
                - id: validate-all-targets-are-not-empty-strings
                  name: Validate that all targets are not empty strings
                  type: aggregate
                  dependsOn:
                    - validate-each-target-is-not-empty-string
                  method: and
        allocation-efficiency:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/1156fcb2-d371-4528-96d4-584fd2141638
            name: allocation-efficiency-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/145c429c-b1d4-4f1f-b5c1-f322f62a34ff
            facts:
                - id: check-app-toml-resource-request
                  name: Check if CPU requests and memory requests are defined in app.toml under [service] or [service.production]
                  type: extract
                  source: github
                  jsonPath: (.service.cpu_requests // .service.production.cpu_requests | . != null) and (.service.memory_requests // .service.production.memory_requests | . != null)
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: check-app-toml-cpu-limits
                  name: Check if CPU limits are not defined in app.toml under [service] or [service.production]
                  type: extract
                  source: github
                  jsonPath: .service.cpu_limits // .service.production.cpu_limits | not
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: check-app-toml-memory-limits
                  name: Check if  memory limits are defined in app.toml under [service] or [service.production]
                  type: extract
                  source: github
                  jsonPath: .service.memory_limits // .service.production.memory_limits | . != null
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: aggregate-resource-requests
                  name: check resource requests and limits
                  type: aggregate
                  dependsOn:
                    - check-app-toml-resource-request
                    - check-app-toml-cpu-limits
                    - check-app-toml-memory-limits
                  method: and
        critical-alerts-slo-check:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/83cf238a-21f9-4fed-9d16-a277bd67bea8
            name: critical-alerts-slo-check-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/65626941-1133-4262-8f52-4e126d409348
            facts:
                - id: fetch-slos
                  name: Fetch SLOs
                  type: extract
                  source: jsonapi
                  uri: https://api.eu1.honeycomb.io/1/slos/ott-load-test-proxy
                  jsonPath: .[].id
                  auth:
                    header: X-Honeycomb-Team
                    tokenVar: HONEYCOMB_API_KEY
                  rule: jsonpath
                - id: fetch-alerts-for-slos
                  name: Fetch alerts for SLOs
                  type: extract
                  dependsOn:
                    - fetch-slos
                  source: jsonapi
                  uri: https://api.eu1.honeycomb.io/1/burn_alerts/ott-load-test-proxy?slo_id=:slo_id
                  jsonPath: .[].id
                  auth:
                    header: X-Honeycomb-Team
                    tokenVar: HONEYCOMB_API_KEY
                  rule: jsonpath
                - id: count-slos
                  name: Count SLOs
                  type: aggregate
                  dependsOn:
                    - fetch-slos
                  method: count
                - id: count-alerts-for-slos
                  name: Count Alerts
                  type: aggregate
                  dependsOn:
                    - fetch-alerts-for-slos
                  method: count
                - id: validate-alerts-for-slos
                  name: Validate that counts match
                  type: validate
                  dependsOn:
                    - count-slos
                    - count-alerts-for-slos
                  rule: deps_match
        deployment-readiness:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/662d6798-74e8-414e-9426-32063ce32f82
            name: deployment-readiness-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/05fd721b-1464-4973-bee6-ac873c3b75c1
            facts:
                - id: deployment-readiness-replicas-service-production
                  name: Check deployment readiness where min != Max, Min >= 3 and Max > 3
                  type: extract
                  source: github
                  jsonPath: (.service.production.replicas_min != .service.production.replicas_max) and (.service.production.replicas_min >= 3) and (.service.production.replicas_max > 3)
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: deployment-readiness-replicas-service
                  name: Check deployment readiness where min != Max, Min >= 3 and Max > 3
                  type: extract
                  source: github
                  jsonPath: (.service.replicas_min != .service.replicas_max) and (.service.replicas_min >= 3) and (.service.replicas_max > 3)
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: aggregate-replicas
                  name: Check deployment readiness where min != Max, Min >= 3 and Max > 3
                  type: aggregate
                  dependsOn:
                    - deployment-readiness-replicas-service-production
                    - deployment-readiness-replicas-service
                  method: or
        high-availability:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/3e086e15-b9c4-42d0-bea4-01f83b59d146
            name: high-availability-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/164a9d9b-cc07-4105-9a31-2bc46ae9c076
            facts:
                - id: app-toml-hpa-target-cpu
                  type: extract
                  source: github
                  jsonPath: .service.target_cpu_utilization_percentage // .service.production.target_cpu_utilization_percentage | . >= 20
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: app-toml-hpa-target-memory
                  type: extract
                  source: github
                  jsonPath: .service.target_memory_utilization_percentage // .service.production.target_memory_utilization_percentage | . >= 20
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: cpu-and-memory-hpa-are-set
                  name: Validate that CPU and Memory Horizontal Pod Autoscalers are set
                  type: aggregate
                  dependsOn:
                    - app-toml-hpa-target-cpu
                    - app-toml-hpa-target-memory
                  method: or
        instrumentation-check:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/3bdb5c44-4aee-45a7-8997-15f77e492246
            name: instrumentation-check-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/98aa724b-bd81-48f1-a002-1b443aa7906c
            facts:
                - id: read-otel-service-name-from-apptoml
                  name: Read OTEL_SERVICE_NAME from app.toml
                  type: extract
                  source: github
                  jsonPath: .envs.OTEL_SERVICE_NAME // .envs.production.OTEL_SERVICE_NAME // .service.production.envs.OTEL_SERVICE_NAME // .service.envs.OTEL_SERVICE_NAME
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: validate-otel-service-name-matches-component-name
                  name: validate OTEL_SERVICE_NAME matches component name
                  type: validate
                  dependsOn:
                    - read-otel-service-name-from-apptoml
                  rule: regex_match
                  pattern: ^ott-load-test-proxy.*$
                - id: read-otel-resource-attributes-from-apptoml
                  name: Read OTEL_RESOURCE_ATTRIBUTES from app.toml
                  type: extract
                  source: github
                  jsonPath: .envs.OTEL_RESOURCE_ATTRIBUTES // .envs.production.OTEL_RESOURCE_ATTRIBUTES // .service.production.envs.OTEL_RESOURCE_ATTRIBUTES
                  repo: ott-load-test-proxy
                  filePath: app.toml
                  rule: jsonpath
                - id: validate-otel-resource-attributes-sample-rate
                  name: validate OTEL_RESOURCE_ATTRIBUTES defines sample rate
                  type: validate
                  dependsOn:
                    - read-otel-resource-attributes-from-apptoml
                  rule: regex_match
                  pattern: of\.sample_rate=\d+.*
                - id: validate-otel-resource-attributes-one-sample-rate
                  name: validate OTEL_RESOURCE_ATTRIBUTES defines one sample rate
                  type: validate
                  dependsOn:
                    - read-otel-resource-attributes-from-apptoml
                  rule: regex_match
                  pattern: of\.error_sample_rate=\d+.*
                - id: either-sample-rate-or-error-sample-rate
                  name: Validate that OTEL_RESOURCE_ATTRIBUTES contains either of.sample_rate or of.error_sample_rate
                  type: aggregate
                  dependsOn:
                    - validate-otel-resource-attributes-sample-rate
                    - validate-otel-resource-attributes-error-sample-rate
                  method: or
                - id: either-sample-rate-or-error-sample-rate
                  name: Validate that both OTEL_SERVICE_NAME and OTEL_RESOURCE_ATTRIBUTES are set up correctly
                  type: aggregate
                  dependsOn:
                    - validate-otel-service-name-matches-component-name
                    - validate-otel-resource-attributes-one-sample-rate
                  method: and
        observability-documentation:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/78d228c1-0f48-45b1-96be-27f03b769d02
            name: observability-documentation-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/8808d2fd-9ea3-4ebb-9652-bfc3ddca7c4c
            facts:
                - id: extract-observability-md
                  name: Extract observability.md
                  type: extract
                  source: github
                  repo: ott-load-test-proxy
                  filePath: docs/observability.md
                  rule: notempty
        organizational-standards:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/2d46fb87-fd34-4f8a-a114-24354211dd21
            name: organizational-standards-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/f2c4711f-89c4-4a36-bebf-dd44336b2bc5
            facts:
                - id: readme-file
                  name: Check if the README.md file exists
                  type: extract
                  source: github
                  repo: ott-load-test-proxy
                  filePath: README.md
                  rule: notempty
                - id: docs-readme-file
                  name: Check if the docs/README.md file exists
                  type: extract
                  source: github
                  repo: ott-load-test-proxy
                  filePath: docs/README.md
                  rule: notempty
                - id: docs-index-file
                  name: Check if the docs/index.md file exists
                  type: extract
                  source: github
                  repo: ott-load-test-proxy
                  filePath: docs/index.md
                  rule: notempty
                - id: paas-onboarded
                  name: Check if the service is using PaaS
                  type: extract
                  source: github
                  repo: ott-load-test-proxy
                  searchString: motain/onefootball-actions/paas-deploy@master
                  rule: search
                - id: aggregate-readme-exists
                  name: Check if repo has documentation
                  type: aggregate
                  dependsOn:
                    - docs-index-file
                    - docs-readme-file
                    - readme-file
                  method: or
                - id: aggregate
                  name: Check if repo follows organizational standards
                  type: aggregate
                  dependsOn:
                    - aggregate-readme-exists
                    - paas-onboarded
                  method: and
        security-as-pipeline:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/362f70cd-1e1c-4475-8348-2b7eed4781ef
            name: security-as-pipeline-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/5476a4d0-3094-4c6e-9394-06ad83be748c
            facts:
                - id: trivy-exists-in-ci
                  name: Check if Trivy is used in CI/CD pipeline
                  type: extract
                  source: github
                  repo: ott-load-test-proxy
                  searchString: motain/onefootball-actions/security
                  rule: search
        vulnerability-management:
            id: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-source/4d010f50-96c4-48c0-bab5-a3dd5112b464/4341aca7-b974-49e5-a5b6-51b8f518ee3f
            name: vulnerability-management-svc-ott-load-test-proxy
            metric: ari:cloud:compass:fca6a80f-888b-4079-82e6-3c2f61c788e2:metric-definition/4d010f50-96c4-48c0-bab5-a3dd5112b464/ebde9d4a-2810-42ec-81c0-8aea8b9e6751
            facts:
                - id: service-vulnerabilities-prometheus
                  name: Get summary of vulnerabilities for services from Prometheus reports
                  type: extract
                  source: prometheus
                  prometheusQuery: sum(trivy_image_vulnerabilities{namespace="ott-load-test-proxy", severity="Critical" })
    tribe: ott
    squad: live-video
